@model List<OJTManagementSystem.ViewModel.EvaluationViewModel>
@{
    ViewData["Title"] = "My Evaluations";
}

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show"><i class="fas fa-exclamation-circle me-2"></i>@TempData["Error"]<button type="button" class="btn-close" data-bs-dismiss="alert"></button></div>
}

@if (Model == null || !Model.Any())
{
    <div class="alert alert-info"><i class="fas fa-info-circle me-2"></i>No evaluations yet. Your supervisor will evaluate you during or at the end of your internship.</div>
}
else
{
    <div class="card">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead><tr><th>Date</th><th>Evaluated By</th><th>Technical</th><th>Punctuality</th><th>Cooperation</th><th>Communication</th><th>Quality</th><th>Reliability</th><th class="text-center">Rating</th><th></th></tr></thead>
                    <tbody>
                        @foreach (var e in Model)
                        {
                            <tr>
                                <td>@e.CreatedAt.ToString("MMM dd, yyyy")</td>
                                <td>@e.SupervisorName</td>
                                <td>@e.TechnicalCompetence.ToString("F1")</td>
                                <td>@e.Punctuality.ToString("F1")</td>
                                <td>@e.Cooperation.ToString("F1")</td>
                                <td>@e.Communication.ToString("F1")</td>
                                <td>@e.QualityOfWork.ToString("F1")</td>
                                <td>@e.Reliability.ToString("F1")</td>
                                <td class="text-center">
                                    @{
                                        var bc = e.FinalRating >= 4.5m ? "bg-success" : e.FinalRating >= 3.5m ? "bg-primary" : e.FinalRating >= 2.5m ? "bg-warning text-dark" : "bg-danger";
                                    }
                                    <span class="badge @bc">@e.FinalRating.ToString("F2") / 5.0</span>
                                </td>
                                <td><a asp-controller="Intern" asp-action="ViewEvaluationDetails" asp-route-evaluationId="@e.EvaluationId" class="btn btn-sm btn-outline-primary"><i class="fas fa-eye"></i></a></td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    @if (Model.Count > 1)
    {
        var avg = Model.Average(x => x.FinalRating);
        <div class="alert alert-secondary mt-3"><i class="fas fa-bar-chart me-2"></i><strong>Overall Average:</strong> <span class="badge bg-primary ms-1">@avg.ToString("F2") / 5.0</span> <span class="text-muted ms-2">across @Model.Count evaluation(s)</span></div>
    }
}
